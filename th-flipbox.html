<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../thelma-core/thelma_core.html">

<polymer-element name="th-flipbox" extends="th-animated" attributes="width height index animateAfter flippable">

  <template>
      <core-style ref="theme"></core-style>
      <style>
        :host {
          width: {{width + "px"}};
          height: {{height + "px"}};
        }

        #container {
          height: 100%;
          width: 100%;
          perspective: 1000;
        }

        #box {
          width: 100%;
          height: 100%;
          position: absolute;
          transform-style: preserve-3d;
          opacity: 0;
        }

        #box > ::content > * {
          /*display: block;*/
          /*padding: 10px;*/
          box-sizing: border-box;
          position: absolute;
          width: 100%;
          height: 100%;
          /*-webkit-backface-visibility: hidden;*/
        }

        ::content .front {
          /*position: absolute;*/
          /*margin: 0;
          -webkit-margin-before: 0;
          -webkit-margin-after: 0;
*/
        }

        ::content .back {
          /*position: absolute;*/
          /*-webkit-transform: rotateY( 180deg );*/
       /*    margin: 0;
          -webkit-margin-before: 0;
          -webkit-margin-after: 0;*/
          /*-webkit-backface-visibility: hidden;*/
        }

      </style>

      <!-- Inline styles are for Safari and mobile support --> 
      <div id="container" on-tap="{{flip}}" style="width: {{width}}px; height: {{height}}px"> 
        <div id="box" style="width: 100%; height: 100%;" >
          <content></content>
        </div>
      </div>

  </template>
  <link rel="import" href="dependencies/web_animations.html">
  <script>

      Polymer('th-flipbox', {
        index: 1,
        animateAfter: 400,
        flippable: true,
        _flipped: false,
        animate: function(){
          var self =  this;
          document.timeline.play(new Animation(self.$.box, [{ opacity: 0},{ opacity: 1}], {duration: 500, delay: self.index*self.animateAfter, fill: "forwards"}));
        },
        flip: function(e, detail, selection){
          var self = this,
              box = selection.querySelector('#box');
        
          if (self.flippable){
            if (self._flipped){
              document.timeline.play(new Animation(box, { transform: "rotateY( 0deg )"}, {duration: 750, fill: "forwards"}));
              self._flipped = false;
            } else {
              document.timeline.play(new Animation(box, { transform: "rotateY( 180deg )"}, {duration: 750, fill: "forwards"}));
              self._flipped = true;
            }
          }
        }
      });

  </script>


</polymer-element>