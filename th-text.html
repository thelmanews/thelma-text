<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../thelma-core/thelma_core.html">


<polymer-element name="th-text" extends="th-animated" attributes="align type markdown text width highlighting">
  <template>
    <core-style ref="theme"></core-style>
    <style>
      :host {
        width: {{width + "px"}};
        color:{{color}};
      }

      #container > * {
        margin: 0;
        -webkit-margin-before: 0;
        -webkit-margin-after: 0;
        text-align: {{align}};
      }

      #container.highlighting > * {
        line-height: 1.2;
        display: inline;
        background-color: {{highlighting}}; /* Not supported in mobile */
        box-shadow: 0.3em 0 0 {{highlighting}}, -0.3em 0 0 {{highlighting}}; /* Not supported in mobile */
      }

      strong {
        font-weight: bold;
      }

      em {
        font-style: italic;
      }

      ul {
        list-style-type: disc;
      }

      ol {
        list-style-type: decimal;
      }


    </style>

    <!-- Add inline styles for mobile --> 
    <div id="container" class="{{type}}" style="color:{{color}}; width:{{width}}px; text-align: {{align}};"><content></content></div>
  </template>
  <script src="../marked/lib/marked.js"></script>

  <script>

      Polymer('th-text', {
        type: "mainpoint",  // options: headline, mainpoint, submainpoint, subpoint, chart, label, caps
        align: "left",  // options: left, right, center, justify
        markdown: true, // set false if other components are embedded (i.e. countup)
        highlighting: '', // enter a color for text highlights
        domReady: function() {
          
          if(this.highlighting){
            // Styles inherited from class work well for desktop browsers
            this.$.container.classList.add("highlighting");

            // Inline styles for mobile version while Polymer does not support use of 
            // variables in style tags on mobile devices
            this.$.container.style.backgroundColor = this.highlighting;
            this.$.container.style.boxShadow = "0.3em 0 0 "+this.highlighting+", -0.3em 0 0 "+this.highlighting;
          }

          if (this.markdown) {
            this.text = this.trim(this.textContent);
          }


        },
        textChanged: function() {
          this.$.container.innerHTML = this.markdown ? marked(this.text.toString()) : this.textContent;
        },
        trim: function(str) { 
          return str.replace(/^[^\S\n]+/gm,'');
        }
      });

  </script>
</polymer-element>